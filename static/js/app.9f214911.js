(function(){"use strict";var e={7434:function(e,s,t){var a=t(9242),o=t(3396);function n(e,s,t,a,n,r){const l=(0,o.up)("NavBar"),c=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(l),((0,o.wg)(),(0,o.j4)(c,{key:e.$route.fullPath}))],64)}t(8052);var r=t(7139);const l=e=>((0,o.dD)("data-v-00e2e5c4"),e=e(),(0,o.Cn)(),e),c={class:"navbar navbar-expand-lg bg-body-tertiary"},i={class:"container"},u=l((()=>(0,o._)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarText","aria-controls":"navbarText","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,o._)("span",{class:"navbar-toggler-icon"})],-1))),p={class:"collapse navbar-collapse",id:"navbarText"},d={class:"navbar-nav me-auto mb-2 mb-lg-0"},m={class:"nav-item"},f={class:"nav-item"},v={key:0,class:"nav-item"},_={key:0,class:"navbar-nav"},w={class:"nav-item"},g={class:"nav-item"},b={key:1,class:"navbar-nav"},y={class:"nav-item"},h={class:"nav-item"};function k(e,s,t,a,n,l){const k=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("nav",c,[(0,o._)("div",i,[(0,o.Wm)(k,{class:"navbar-brand",to:{name:"home"}},{default:(0,o.w5)((()=>[(0,o.Uk)("MySpace")])),_:1}),u,(0,o._)("div",p,[(0,o._)("ul",d,[(0,o._)("li",m,[(0,o.Wm)(k,{class:"nav-link",to:{name:"home"}},{default:(0,o.w5)((()=>[(0,o.Uk)("首页")])),_:1})]),(0,o._)("li",f,[(0,o.Wm)(k,{class:"nav-link",to:{name:"userlist"}},{default:(0,o.w5)((()=>[(0,o.Uk)("好友列表")])),_:1})]),e.$store.state.user.is_login?((0,o.wg)(),(0,o.iD)("li",v,[(0,o.Wm)(k,{class:"nav-link",to:{name:"userprofile",params:{userid:e.$store.state.user.id}}},{default:(0,o.w5)((()=>[(0,o.Uk)("我的空间")])),_:1},8,["to"])])):(0,o.kq)("",!0)]),e.$store.state.user.is_login?((0,o.wg)(),(0,o.iD)("ul",b,[(0,o._)("li",y,[(0,o.Wm)(k,{class:"nav-link",to:{name:"userprofile",params:{userid:e.$store.state.user.id}}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,r.zw)(e.$store.state.user.username),1)])),_:1},8,["to"])]),(0,o._)("li",h,[(0,o.Wm)(k,{class:"nav-link",style:{cursor:"pointer"},onClick:a.logout,to:{name:"home"}},{default:(0,o.w5)((()=>[(0,o.Uk)("退出")])),_:1},8,["onClick"])])])):((0,o.wg)(),(0,o.iD)("ul",_,[(0,o._)("li",w,[(0,o.Wm)(k,{class:"nav-link",to:{name:"login"}},{default:(0,o.w5)((()=>[(0,o.Uk)("登录")])),_:1})]),(0,o._)("li",g,[(0,o.Wm)(k,{class:"nav-link",to:{name:"register"}},{default:(0,o.w5)((()=>[(0,o.Uk)("注册")])),_:1})])]))])])])}var C=t(65),j={name:"NavBar",setup(){const e=(0,C.oR)(),s=()=>{e.commit("logout")};return{logout:s}}},U=t(89);const P=(0,U.Z)(j,[["render",k],["__scopeId","data-v-00e2e5c4"]]);var x=P,D={name:"App",components:{NavBar:x}};const B=(0,U.Z)(D,[["render",n]]);var O=B,T=t(2483);function z(e,s,t,a,n,r){const l=(0,o.up)("ContentBase");return(0,o.wg)(),(0,o.j4)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" 首页 ")])),_:1})}const W={class:"home"},I={class:"container"},S={class:"card"},H={class:"card-body"};function Z(e,s,t,a,n,r){return(0,o.wg)(),(0,o.iD)("div",W,[(0,o._)("div",I,[(0,o._)("div",S,[(0,o._)("div",H,[(0,o.WI)(e.$slots,"default",{},void 0,!0)])])])])}var A={name:"ContentBase"};const q=(0,U.Z)(A,[["render",Z],["__scopeId","data-v-23722d22"]]);var R=q,V={name:"HomeView",components:{ContentBase:R}};const F=(0,U.Z)(V,[["render",z]]);var E=F;const M=["onClick"],$={class:"card-body"},N={class:"row"},G={class:"col-1"},L=["src"],Y={class:"col-11"},K={class:"username"},J={class:"followerCount"};function Q(e,s,t,a,n,l){const c=(0,o.up)("ContentBase");return(0,o.wg)(),(0,o.j4)(c,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.friends,(e=>((0,o.wg)(),(0,o.iD)("div",{class:"card friend",key:e.id,onClick:s=>a.open_user_profile(e.id)},[(0,o._)("div",$,[(0,o._)("div",N,[(0,o._)("div",G,[(0,o._)("img",{class:"img-fluid",src:e.photo,alt:""},null,8,L)]),(0,o._)("div",Y,[(0,o._)("div",K,(0,r.zw)(e.username),1),(0,o._)("div",J,(0,r.zw)(e.followerCount),1)])])])],8,M)))),128))])),_:1})}t(7658);var X=t(7387),ee=t.n(X),se=t(4870),te={name:"UserList",components:{ContentBase:R},setup(){const e=(0,C.oR)();let s=(0,se.iH)([]);ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/userlist/",type:"get",success(e){s.value=e}});const t=s=>{e.state.user.is_login?(console.log(s),Cs.push({name:"userprofile",params:{userid:s}})):Cs.push({name:"login"})};return{friends:s,open_user_profile:t}}};const ae=(0,U.Z)(te,[["render",Q],["__scopeId","data-v-6da27c09"]]);var oe=ae;const ne={class:"row"},re={class:"col-3"},le={class:"col-9"};function ce(e,s,t,a,n,r){const l=(0,o.up)("UserProfileInfo"),c=(0,o.up)("UserProfileWrite"),i=(0,o.up)("UserProfilePosts"),u=(0,o.up)("ContentBase");return(0,o.wg)(),(0,o.j4)(u,null,{default:(0,o.w5)((()=>[(0,o._)("div",ne,[(0,o._)("div",re,[(0,o.Wm)(l,{onFollow:a.follow,onUnfollow:a.unfollow,user:a.user},null,8,["onFollow","onUnfollow","user"]),a.is_me?((0,o.wg)(),(0,o.j4)(c,{key:0,onPost:a.post},null,8,["onPost"])):(0,o.kq)("",!0)]),(0,o._)("div",le,[(0,o.Wm)(i,{user:a.user,posts:a.posts,onDelete_a_post:a.delete_a_post},null,8,["user","posts","onDelete_a_post"])])])])),_:1})}t(541);const ie={class:"card"},ue={class:"card-body"},pe={class:"row"},de={class:"col-4 img-center"},me=["src"],fe={class:"col-8"},ve={class:"username"},_e={class:"fans"};function we(e,s,t,a,n,l){return(0,o.wg)(),(0,o.iD)("div",ie,[(0,o._)("div",ue,[(0,o._)("div",pe,[(0,o._)("div",de,[(0,o._)("img",{class:"img-fluid",src:t.user.photo,alt:""},null,8,me)]),(0,o._)("div",fe,[(0,o._)("div",ve,(0,r.zw)(t.user.username),1),(0,o._)("div",_e,"粉丝数："+(0,r.zw)(t.user.followerCount),1),t.user.is_followed?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:s[0]||(s[0]=(...e)=>a.follow&&a.follow(...e)),type:"button",class:"btn btn-primary"},"+关注")),t.user.is_followed?((0,o.wg)(),(0,o.iD)("button",{key:1,onClick:s[1]||(s[1]=(...e)=>a.unfollow&&a.unfollow(...e)),type:"button",class:"btn btn-primary"},"取消关注")):(0,o.kq)("",!0)])])])])}var ge={name:"UserProfileInfo",props:{user:{type:Object,required:!0}},setup(e,s){const t=(0,C.oR)(),a=()=>{ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/follow/",type:"POST",data:{target_id:e.user.id},headers:{Authorization:"Bearer "+t.state.user.access},success(e){"success"===e.result&&s.emit("follow")}})},o=()=>{ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/follow/",type:"POST",data:{target_id:e.user.id},headers:{Authorization:"Bearer "+t.state.user.access},success(e){"success"===e.result&&s.emit("unfollow")}})};return{follow:a,unfollow:o}}};const be=(0,U.Z)(ge,[["render",we],["__scopeId","data-v-64dd9a80"]]);var ye=be;const he=e=>((0,o.dD)("data-v-c4f1c236"),e=e(),(0,o.Cn)(),e),ke={class:"card"},Ce={class:"card-body"},je={class:"card single-post"},Ue={class:"card-body"},Pe=["onClick"],xe=he((()=>(0,o._)("button",{type:"button",class:"btn btn-info btn-sm"},"修改",-1)));function De(e,s,t,a,n,l){return(0,o.wg)(),(0,o.iD)("div",ke,[(0,o._)("div",Ce,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.posts.posts,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id},[(0,o._)("div",je,[(0,o._)("div",Ue,[(0,o.Uk)((0,r.zw)(e.content)+" ",1),a.is_me?((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",class:"btn btn-danger btn-sm",onClick:s=>a.delete_a_post(e.id)},"删除",8,Pe)):(0,o.kq)("",!0),xe])])])))),128))])])}var Be={name:"UserProfilePosts",props:{posts:{type:Object,required:!0},user:{type:Object,required:!0}},setup(e,s){const t=(0,C.oR)();let a=(0,o.Fl)((()=>e.user.id===t.state.user.id));const n=e=>{ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/post/",type:"DELETE",data:{post_id:e},headers:{Authorization:"Bearer "+t.state.user.access},success(t){"success"===t.result&&s.emit("delete_a_post",e)}})};return{is_me:a,delete_a_post:n}}};const Oe=(0,U.Z)(Be,[["render",De],["__scopeId","data-v-c4f1c236"]]);var Te=Oe;const ze=e=>((0,o.dD)("data-v-0713c9a8"),e=e(),(0,o.Cn)(),e),We={class:"card edit-field"},Ie={class:"card-body"},Se=ze((()=>(0,o._)("label",{for:"edit-post",class:"form-label"},"编辑帖子",-1)));function He(e,s,t,n,r,l){return(0,o.wg)(),(0,o.iD)("div",We,[(0,o._)("div",Ie,[Se,(0,o.wy)((0,o._)("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>n.content=e),class:"form-control",id:"exampleFormControlTextarea1",rows:"3"},null,512),[[a.nr,n.content]]),(0,o._)("button",{onClick:s[1]||(s[1]=(...e)=>n.post&&n.post(...e)),type:"button",class:"btn btn-primary post-button"},"发帖")])])}var Ze={name:"UserProfileWrite",setup(e,s){const t=(0,C.oR)();let a=(0,se.iH)("");const o=()=>{ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/post/",type:"POST",data:{content:a.value},headers:{Authorization:"Bearer "+t.state.user.access},success(e){"success"===e.result&&0!==a.value.trim().length&&s.emit("post",a.value),a.value=""}})};return{content:a,post:o}}};const Ae=(0,U.Z)(Ze,[["render",He],["__scopeId","data-v-0713c9a8"]]);var qe=Ae,Re={name:"UserProfile",components:{ContentBase:R,UserProfileInfo:ye,UserProfilePosts:Te,UserProfileWrite:qe},setup(){const e=(0,C.oR)(),s=(0,T.yj)(),t=parseInt(s.params.userid),a=(0,se.qj)({}),n=(0,se.qj)({});ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/getinfo/",type:"GET",data:{user_id:t},headers:{Authorization:"Bearer "+e.state.user.access},success(e){a.id=e.id,a.username=e.username,a.photo=e.photo,a.followerCount=e.followerCount,a.is_followed=e.is_followed}}),ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/post/",type:"GET",data:{user_id:t},headers:{Authorization:"Bearer "+e.state.user.access},success(e){n.count=e.length,n.posts=e}});const r=()=>{a.is_followed=!0,a.followerCount++},l=()=>{a.is_followed=!1,a.followerCount--},c=e=>{n.count++,n.posts.unshift({id:c.count,userid:1,content:e})},i=e=>{n.posts=n.posts.filter((s=>s.id!==e)),n.count=n.posts.length},u=(0,o.Fl)((()=>t===e.state.user.id));return{user:a,follow:r,unfollow:l,posts:n,post:c,is_me:u,delete_a_post:i}}};const Ve=(0,U.Z)(Re,[["render",ce]]);var Fe=Ve;const Ee=e=>((0,o.dD)("data-v-643be81b"),e=e(),(0,o.Cn)(),e),Me={class:"row justify-content-md-center"},$e={class:"col-4"},Ne={class:"mb-3"},Ge=Ee((()=>(0,o._)("label",{for:"username",class:"form-label"},"用户名",-1))),Le={class:"mb-3"},Ye=Ee((()=>(0,o._)("label",{for:"password",class:"form-label"},"密码",-1))),Ke={class:"error-message"},Je=Ee((()=>(0,o._)("button",{type:"submit",class:"btn btn-primary"},"登录",-1)));function Qe(e,s,t,n,l,c){const i=(0,o.up)("ContentBase");return(0,o.wg)(),(0,o.j4)(i,null,{default:(0,o.w5)((()=>[(0,o._)("div",Me,[(0,o._)("div",$e,[(0,o._)("form",{onSubmit:s[2]||(s[2]=(0,a.iM)(((...e)=>n.login&&n.login(...e)),["prevent"]))},[(0,o._)("div",Ne,[Ge,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>n.username=e),type:"texdt",class:"form-control",id:"username"},null,512),[[a.nr,n.username]])]),(0,o._)("div",Le,[Ye,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>n.password=e),type:"password",class:"form-control",id:"password"},null,512),[[a.nr,n.password]])]),(0,o._)("div",Ke,(0,r.zw)(n.error_message),1),Je],32)])])])),_:1})}var Xe={name:"LoginView",components:{ContentBase:R},setup(){const e=(0,C.oR)();let s=(0,se.iH)(""),t=(0,se.iH)(""),a=(0,se.iH)("");const o=()=>{a.value="",e.dispatch("login",{username:s.value,password:t.value,success(){Cs.push({name:"userprofile",params:{userid:e.state.user.id}})},error(){a.value="用户名或密码错误"}})};return{username:s,password:t,error_message:a,login:o}}};const es=(0,U.Z)(Xe,[["render",Qe],["__scopeId","data-v-643be81b"]]);var ss=es;const ts=e=>((0,o.dD)("data-v-33a60062"),e=e(),(0,o.Cn)(),e),as={class:"row justify-content-md-center"},os={class:"col-4"},ns={class:"mb-3"},rs=ts((()=>(0,o._)("label",{for:"username",class:"form-label"},"用户名",-1))),ls={class:"mb-3"},cs=ts((()=>(0,o._)("label",{for:"password",class:"form-label"},"密码",-1))),is={class:"mb-3"},us=ts((()=>(0,o._)("label",{for:"password_confirm",class:"form-label"},"确认密码",-1))),ps={class:"error-message"},ds=ts((()=>(0,o._)("button",{type:"submit",class:"btn btn-primary"},"登录",-1)));function ms(e,s,t,n,l,c){const i=(0,o.up)("ContentBase");return(0,o.wg)(),(0,o.j4)(i,null,{default:(0,o.w5)((()=>[(0,o._)("div",as,[(0,o._)("div",os,[(0,o._)("form",{onSubmit:s[3]||(s[3]=(0,a.iM)(((...e)=>n.register&&n.register(...e)),["prevent"]))},[(0,o._)("div",ns,[rs,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>n.username=e),type:"texdt",class:"form-control",id:"username"},null,512),[[a.nr,n.username]])]),(0,o._)("div",ls,[cs,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>n.password=e),type:"password",class:"form-control",id:"password"},null,512),[[a.nr,n.password]])]),(0,o._)("div",is,[us,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>n.password_confirm=e),type:"password",class:"form-control",id:"password"},null,512),[[a.nr,n.password_confirm]])]),(0,o._)("div",ps,(0,r.zw)(n.error_message),1),ds],32)])])])),_:1})}var fs={name:"RegisterView",components:{ContentBase:R},setup(){const e=(0,C.oR)();let s=(0,se.iH)(""),t=(0,se.iH)(""),a=(0,se.iH)(""),o=(0,se.iH)("");const n=()=>{ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/user/",type:"POST",data:{username:s.value,password:t.value,password_confirm:a.value},success(a){"success"===a.result?e.dispatch("login",{username:s.value,password:t.value,success(){Cs.push({name:"userprofile",params:{userid:e.state.user.id}})},error(){o.value="系统异常，请稍后重试"}}):o.value=a.result}})};return{username:s,password:t,password_confirm:a,error_message:o,register:n}}};const vs=(0,U.Z)(fs,[["render",ms],["__scopeId","data-v-33a60062"]]);var _s=vs;function ws(e,s,t,a,n,r){const l=(0,o.up)("ContentBase");return(0,o.wg)(),(0,o.j4)(l,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" 404 Not Found ")])),_:1})}var gs={name:"NotFound",components:{ContentBase:R}};const bs=(0,U.Z)(gs,[["render",ws]]);var ys=bs;const hs=[{path:"/myspace/",name:"home",component:E},{path:"/myspace/userlist/",name:"userlist",component:oe},{path:"/myspace/userprofile/:userid/",name:"userprofile",component:Fe},{path:"/myspace/login/",name:"login",component:ss},{path:"/myspace/register/",name:"register",component:_s},{path:"/myspace/404/",name:"404",component:ys},{path:"/myspace/:catchAll(.*)",redirect:"/myspace/404/"}],ks=(0,T.p7)({history:(0,T.PO)(),routes:hs});var Cs=ks,js=t(1598);const Us={state:{id:"",username:"",photo:"",followCounter:0,access:"",refresh:"",is_login:!1},getters:{},mutations:{updateUser(e,s){e.id=s.id,e.username=s.username,e.photo=s.photo,e.followCounter=s.followCounter,e.access=s.access,e.refresh=s.refresh,e.is_login=s.is_login},updateAccess(e,s){e.access=s},logout(e){e.id="",e.username="",e.photo="",e.followCounter=0,e.access="",e.refresh="",e.is_login=!1}},actions:{login(e,s){ee().ajax({url:"https://app165.acapp.acwing.com.cn/api/token/",type:"POST",data:{username:s.username,password:s.password},success(t){const{access:a,refresh:o}=t,n=(0,js.Z)(a);setInterval((()=>{ee().ajax({url:"https://app165.acapp.acwing.com.cn/api/token/refresh/",type:"POST",data:{refresh:o},success(s){e.commit("updateAccess",s.access)}})}),27e3),ee().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/getinfo/",type:"GET",data:{user_id:n.user_id},headers:{Authorization:"Bearer "+a},success(t){e.commit("updateUser",{...t,access:a,refresh:o,is_login:!0}),s.success()}})},error(){s.error()}})}},modules:{}};var Ps=Us,xs=(0,C.MT)({state:{},getters:{},mutations:{},actions:{},modules:{user:Ps}});(0,a.ri)(O).use(xs).use(Cs).mount("#app")}},s={};function t(a){var o=s[a];if(void 0!==o)return o.exports;var n=s[a]={exports:{}};return e[a].call(n.exports,n,n.exports,t),n.exports}t.m=e,function(){var e=[];t.O=function(s,a,o,n){if(!a){var r=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],n=e[u][2];for(var l=!0,c=0;c<a.length;c++)(!1&n||r>=n)&&Object.keys(t.O).every((function(e){return t.O[e](a[c])}))?a.splice(c--,1):(l=!1,n<r&&(r=n));if(l){e.splice(u--,1);var i=o();void 0!==i&&(s=i)}}return s}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[a,o,n]}}(),function(){t.n=function(e){var s=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(s,{a:s}),s}}(),function(){t.d=function(e,s){for(var a in s)t.o(s,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:s[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};t.O.j=function(s){return 0===e[s]};var s=function(s,a){var o,n,r=a[0],l=a[1],c=a[2],i=0;if(r.some((function(s){return 0!==e[s]}))){for(o in l)t.o(l,o)&&(t.m[o]=l[o]);if(c)var u=c(t)}for(s&&s(a);i<r.length;i++)n=r[i],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(u)},a=self["webpackChunkmyspace"]=self["webpackChunkmyspace"]||[];a.forEach(s.bind(null,0)),a.push=s.bind(null,a.push.bind(a))}();var a=t.O(void 0,[998],(function(){return t(7434)}));a=t.O(a)})();
//# sourceMappingURL=app.9f214911.js.map